---
title: "Linux\_进程基本知识"
date: 2018-03-18 23:04:12
categories:
- 技术
tags:
- Linux
- 进程
---

# Linux 进程基本知识

## 概述
进程是操作系统的基本而重要的概念，对进程最初的认识是处于运行中程序。从操作系统的角度看待进程，它是获取资源的最小单元。本文从操作系统提供的系统调用接口看待进程，从进程出生到死亡，学习Linux平台上的系统调用接口，本文不涉及进程间通信相关知识。

<!--more-->

## 进程相关的接口函数
学习服务器编程，必定涉及到多进程，所以，熟悉操作系统知识和提供的进程相关接口函数是入门服务器编程的必经之路。
### 创建进程

#### fork
创建一个子进程
1. 最大特征是调用一次，返回两次。父进程中返回正数进程号码，子进程返回0，然后两个进程继续向后执行
2. 子进程获得父进程的栈，数据段，堆，和执行文本
3. 子进程共享父进程打开的文件句柄

#### vfork
不复制虚拟内存和页表，共享父进程内存
子进程调用_exit或者exec之前，父进程暂停执行

#### clone
创建新进程，程序起点不是调用点，而是func参数指定的函数

#### execve
一系列函数，将当前进程的资源全部替换为新程序所需资源
#### system
执行任何linux命令

### 获取进程状态
通过SIGCHLD信号或者wait系统调用获取进程状态信息
### wait
获取任意子进程终止状态信息
一直阻塞，直到某一个子进程终止
status参数返回子进程终止信息
内核将所有子进程追加进程CPU时间和资源使用数据
子进程ID作为wait结果返回
不能处理子进程因信号停止或是停止子进程因信号恢复运行



### waitpid
比wait更加精确
增加了pid_t参数，能够检测指定的进程或者进程组；以及option选项，检测因信号停止、运行等状态的进程
status返回值（宏测试）可以区分子进程事件
waitid、wait3、wait4更加丰富的接口
 


### 进程终止
#### exit 和 _exit
异常终止或者正常终止
exit 调用退出处理函数，刷新缓冲区，执行_exit系统调用
main函数返回或者执行到结尾
进程终止会执行一堆清理工作，关闭文件描述符等
on_exit atexit注册退出处理函数，按照注册顺序，逆序调用

行缓冲，块缓冲，fork之前 fflush 刷新缓冲，或者setvbuf、 setbuf 关闭缓冲
write会将数据直接传递给内核缓冲区，fork不会复制这一缓冲区

### 杂项
#### 写时拷贝技术
fork进程的时候，并不是一开始就copy父进程的所有资源到子进程，而是当父子进程需要修改资源的时候，再按需copy父进程中的资源到子进程

#### 竞态
fork后是父进程还是子进程先执行，没有确定关系，需要采用同步技术（不能简单靠sleep），常见的同步技术有：信号量，文件锁，管道，信号。

#### 孤儿进程和僵尸进程
子进程的父进程终止后，该子进程为孤儿进程，init进程接管该孤儿进程
子进程终止后，如果父进程没有wait，那么该子进程为僵尸进程。内核会保留子进程ID、终止状态、资源使用数据等信息，父进程如果一直不wait，这些数据会一直存在。通过信号都不能杀死僵尸进程。


<!--## 注意事项-->


