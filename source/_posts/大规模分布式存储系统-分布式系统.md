---
title: 大规模分布式存储系统-分布式系统
date: 2018-04-09 22:32:35
categories:
- 技术 
tags:
- 分布式系统
---

# 分布式系统概念和性能评估方法
## 
存储到多节点
多副本一致性

故障率高，需要自动容错
<!--more-->

## 基本概念
### 异常
节点不可靠
网络不可靠
1. 服务器宕机
    通过读取持久化介质中数据恢复内存信息
2. 网络异常
    任何消息只有收到对方回复才可以认为发送成功
3.磁盘故障
    磁盘损坏（备份恢复），磁盘数据错误（校验和）
    
1.超时
    三态：成功、失败、超时
    操作设计为“幂等”，执行一次与多次结果相同
### 一致性
冗余存储多份

用户
存储系统

强一致性：保证新值
弱一致性：不保证新值
最终一致性：有一段时间不确定

用户角度：
读写一致性：同一个用户读写一致，其他用户可能过一会儿才回看到新值
会话一致性：会话期间读写一致
单调读一致性：A读到了某个值，后续操作不会读到更早的值
单调写一致性：多个副本需要按照与客户端相同顺序完成

存储系统角度：
副本一致性
更新顺序一致性

### 衡量指标
性能：
系统吞吐能力： QPS TPS
系统响应时间：平均延时或者99%以上请求最大延时
可用性：
系统面对各种异常时，可以提供正常服务的能力
使用系统停止服务时间与正常服务时间比例
一致性：
可扩展性：扩展集群服务器规模提高系统存储容量、计算量和性能的能力


## 性能
### 性能分析
首先分析整体架构，接着重点分析可能成为瓶颈的单个机器模块。
例子分析

磁盘、内存、CPU、网络、负载均衡都会使性能分析分析复杂化

## 数据分布
哈希分布
顺序分布
哈希算法、数据倾斜问题
一致哈希算法
顺序分布。Meta和Root表机制，表分裂与合并操作。

## 负载均衡
总控节点、工作节点
工作节点上报状态信息，总控节点负责分派调度。让新加入节点平滑过渡。
主副本、多个备用副本

## 复制
强同步复制：一个副本回复就ok，副本再通知其他副本
异步复制：复制线程将客户端修改推送到其他副本
一致性和可用性之间权衡

复制协议
主副本故障，需要选举一个备副本为新主副本，Paxos协议

回放操作日志
成组提交
检查点






# 分布式系统理论基础

# 分布式协议
Paxos选举协议: 多个节点达成一致？
两阶段t提交协议: 跨多个节点操作的原子性 

