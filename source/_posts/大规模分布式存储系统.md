---
title: 大规模分布式存储系统
date: 2018-04-08 22:15:51
categories:
- 技术 
tags:
- 分布式存储
---

# 概述
## 当前的问题
需要处理的数据越来越多、数据量越来越大
环境复杂，部分机器工作，部分出故障
RPC调用异步调用耗时长

## 节省成本带来的问题
普通服务器故障率高，需要自动容错，软件层面需要自动负载均衡，使得系统处理能力得到线性扩展

分布式存储与云存储和大数据的关系？
分布式存储是基础，云存储和大数据是构建在分布式存储上的应用。
<!--more-->
## 目标
低成本、高性能、可扩展、易用

## 互联网分布式系统特点
规模大、成本低

## 定义
分布式存储系统是大量普通PC服务器通过Internet互联，对外作为一个整体提供存储服务

## 特征
可扩展
低成本
高性能
易用

## 技术难点
数据分布：如何分不到多台服务器、跨服务器读写
一致性：副本一致性、异常下数据一致性
容错：服务器故障后数据处理
负载均衡：新增服务器和正常服务器之间、数据迁移时
事务与并发控制：分布式事务、并发事务
易用性：提供对外接口
压缩/解压缩：

## 分类
数据分类：
非结构化数据：例如视频、音频等 (Blob数据)
结构化数据：例如表格
半结构化数据: 例如HTML文档

分布式系统分类：
分布式文件系统：Facebook Haystack、Taobao File System，也作为分布式表格系统底层存储，存储Blob数据、定长块、大文件。系统内部按照数据块组织数据，每个数据块大小大致相同。
分布式键值系统：存储关系简单的半结构化数据，提供基于主键的CEUD功能。用于分布式表格系统的一种简化实现，用作缓存。Amazon Dynamo、Taobao Tair；一致性哈希技术。
分布式表格系统：存储关系较复杂半结构化数据，增加支持扫描某个主键范围，以表格为单位组织数据。主要支持单张表格操作。Google Bigtable
分布式数据库：存储结构化数据，提供SQL关系查询语句、多表关联、嵌套子查询等复杂操作

关系数据库存在问题：
可扩展（很难高效地扩展到多个存储节点上）
高并发（面对高并发应用的性能优化空间较大）


# 单机存储系统

单机存储引擎是哈希表、B树等数据结构在机械磁盘、SSD等持久化介质上的实现。
单机存储系统是单机存储引擎的一种封装，对外提供文件、键值、表格或者关系模型。

数据库事务：一个或者多个操作的集合，ACID

## CPU架构
内存
总线
CPU（L3 Cache、 L2 Cache）

NUMA：Non-Uniform Memory Access 架构

尽量减少不同NUMA节点之间信息交互

## IO总线
北桥，内存，速度快
南桥，磁盘、速度慢

## 网络拓扑
核心层、汇聚层、接入层
网络拓扑扁平化，减少跨数据中心传输

## 性能参数
磁盘读写
存储系统性能瓶颈主要在于磁盘随机读写。设计存储引擎的时候会针对磁盘的特性做很多处理，比如随机写操作转化为顺序写，通过缓存减少磁盘随机读操作。
可以使用SSD做缓存或者性能要求较高的关键业务（随机读取延迟小，能够提供很好的IOPS）

## 存储系统性能指标
吞吐量、访问延时

## 单机存储引擎
### 哈希存储引擎
增、删、读、修改操作
Bitcask
添加数据到活跃文件
定期合并
快速恢复

### B树存储引擎
B树 B+树
缓冲区管理：LRU算法 LIRS算法

### LSM树存储引擎

## 数据模型
存储系统的外壳
文件 
关系 
键值模型

## 事务与比并发控制
ACID
数据库锁
写时复制
多版本并发控制

## 故障恢复
日志
重做日志
优化手段：
成组提交
检查点

## 压缩
压缩算法
列式存储






